---
layout: null
sitemap: false
permalink: "/stats.html"
---
<html>
<head>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <style>
    table {
      text-align: center;
      font-size: 2em
    }
    table td, table th {
      padding: 0.5em;
    }
    table.log {
      margin-left: 3em;
    }
    table.log td, table.log th {
      border: 1px solid lightgrey;
    }
  </style>
</head>
<body>
<h1>Stats</h1>

<table class="stats">
  <tr>
    <td><b>Total number of posts</b></td>
    <td><b>Total reading time (minutes)</b></td>
  </tr>
  <tr>
    <td><span id="total-n-posts"></span></td>
    <td><span id="total-reading-time"></span></td>
  </tr>
  <tr>
    <td><b>Count the posts by category</b></td>
    <td><b>Count the posts by year</b></td>
  </tr>
  <tr>
    <td>
      <div id="posts-by-category" style="width: 700px; height: 300px;"></div>
    </td>
    <td>
      <div id="posts-by-year" style="width: 700px; height: 300px;"></div>
    </td>
  </tr>
</table>

{% assign posts = site.posts %}
<table class="log">
  <tr>
    <th>Date</th>
    <th>Name</th>
    <th>Reading time (minutes)</th>
  </tr>
{%- for post in posts %}
  <tr>
    <td>{{post.date | date: '%Y-%m-%d' }}</td>
    <td><a href="{{post.url}}">{{post.title}}</a></td>
    <td>{{post.time_reading_minutes}}</td>
  </tr>
{%- else -%}
  <tr><td colspan="3">No one available posts</td></tr>
{%- endfor %}
</table>

<script type="text/javascript">

  // visualization
  function buildValueChart(value, id) {
    let elementHTML = document.getElementById(id);
    elementHTML.innerText = value;
  }

  function buildDonutPieChart(result, id) {
    google.charts.load("current", {packages: ["corechart"]});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
      var data = google.visualization.arrayToDataTable(result);

      var options = {
        title: '',
        pieHole: 0.4,
      };

      var chart = new google.visualization.PieChart(document.getElementById(id));
      chart.draw(data, options);
    }
  }

  function buildBarChart(xTitle, yTitle, result, id) {
    google.charts.load('current', {'packages': ['bar']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
      var data = google.visualization.arrayToDataTable(result);

      var options = {
        chart: {
          title: '',
        },
        bars: 'vertical',
        legend: {
          position: 'none'
        },
        hAxis: {
          title: xTitle
        },
        vAxis: {
          title: yTitle
        }
      };

      var chart = new google.charts.Bar(document.getElementById(id));
      chart.draw(data, google.charts.Bar.convertOptions(options));
    }
  }

  // analytics
  function countBy(values, fn) {
    return values
      .map(typeof fn === 'function' ? fn : val => val[fn])
      .reduce((acc, val) => {
        acc[val] = (acc[val] || 0) + 1;
        return acc;
      }, {});
  }

  function getNumberOfPosts(posts) {
    return posts.length;
  }

  function getTotalNumberOfReadingTime(posts) {
    // TODO: Implement getTotalNumberOfReadingTime
    console.log(posts);
    let sum = 0;
    posts.forEach(post => {
      sum += post["time_reading_minutes"];
    });
    return sum;
  }

  function getStatsPostsByCategory(posts) {
    let countBlogPostsByCategory = countBy(posts, post => post.category);
    const result = [];
    for (const [key, value] of Object.entries(countBlogPostsByCategory)) {
      result.push([key, value]);
    }
    result.sort((x, y) => {
      if (x[0] < y[0]) {
        return -1;
      } else if (x[0] > y[0]) {
        return 1;
      } else {
        return 0;
      }
    });
    result.unshift(["Category", "Number of posts"])
    return result;
  }

  function getStatsPostsByYear(posts) {
    let countBlogPostsByYear = countBy(posts, post => post.year);
    const result = [];
    for (const [key, value] of Object.entries(countBlogPostsByYear)) {
      result.push([key, value]);
    }
    result.sort((x, y) => {
      if (x[0] < y[0]) {
        return -1;
      } else if (x[0] > y[0]) {
        return 1;
      } else {
        return 0;
      }
    });
    result.unshift(["Year", "Number of posts"])
    return result;
  }

  // data processing
  const url = "/stats.json";

  fetch(url)
    .then((response) => {
      return response.json();
    })
    .then((data) => {
      buildValueChart(
        getNumberOfPosts(data),
        "total-n-posts"
      );

      buildValueChart(
        getTotalNumberOfReadingTime(data),
        "total-reading-time"
      );

      buildDonutPieChart(
        getStatsPostsByCategory(data),
        "posts-by-category"
      );

      buildBarChart(
        "Year",
        "Number of posts",
        getStatsPostsByYear(data),
        "posts-by-year"
      );
    });
</script>
</body>
</html>
